АНАЛИЗ СХОЖЕСТИ ПУЛЬСОВЫХ ВОЛН В ФОТОПЛЕТИЗМОГРАММАХ

Введение
В настоящее время роль информационных технологий в медицине продолжает расти. Появляются новые, более дешёвые и менее болезненные методы диагностики, повышается точность измерений. Огромную популярность приобрели неинвазивные (не требующие воздействия хирургическими инструментами на кожу пациентов) методы исследования. Одна из областей медицины, где широко применяются информационные технологии, – анализ сигналов кровяного давления. Наиболее распространенные методы измерения таких сигналов – электрокардиография и фотоплетизмография. 
В данной работе изучаются фотоплетизмограммы (photoplethysmograms, PPG) – сигналы, получаемые с помощью фотоплетизмографии, т.е. в результате просвечивания инфракрасным излучением какого-либо органа (как правило, пальца руки) и измерения степени поглощения света датчиком с противоположной стороны. Значения фотоплетизмограммы отражают плотность кровяного потока в органе и сильно коррелируют со значениями давления в кровеносной системе. Из-за своей простоты, дешевизны и безболезненности такой метод также нашел множество применений в медицине [1] – [4].
Считается, что фотоплетизмограмма состоит из нескольких компонент, например, волны Майера [5], волны дыхания, пульсовой волны. Именно пульсовая волна (а следовательно, её корректное выделение) представляет наибольший интерес для исследователей, поскольку её характеристики связаны с состоянием сердечно-сосудистой системы человека [3] – [4]. В данной работе мы также сконцентрируемся на изучении пульсовых волн. В пульсовых волнах выделяют особые точки (локальные экстремумы волн или их производных, иногда высоких порядков, см. рис. 1), с их помощью вычисляются различные характеристики:
• индекс аугментации (augmentation index, AI) – имеет связь с риском сердечно-сосудистых заболеваний [6], жесткостью стенок аорты и наличием гиперхолестеринемии [7],
• индекс жёсткости (stiffness index, SI) [7] – [8],
• тип пульсовой кривой (А, В или С) – по типу можно косвенно судить об эластичности стенок артерий [9],
• биологический возраст сосудов (VA - Vascular Aging) – показывает биологический возраст, т.е. «изношенность» организма [9],
• уровень кислорода в крови (т.н. индекс сатурации или насыщение крови кислородом) [9] и т.д. 
Отметим также, что в настоящее время существует множество подходов к исследованию сигналов кровяного давления [10]. Можно выделить применение метода главных компонент, преобразования Фурье, анализа независимых компонент, методов оценки параметров [11] и машинного обучения [12]. 
Постановка задачи
Главный объект исследования в данной работе – сигналы, получаемые с помощью прибора «АнгиоСкан–01М» российской компании ООО «Ангиоскан-Электроникс» [9]. Прибор регистрирует фотоплетизмограмму и вычисляет по ней ряд параметров (некоторые перечислены выше). Практика показывает, что значения параметров могут сильно варьироваться при последовательных измерениях. Поэтому возникает естественный вопрос: что является причиной таких изменений (природа самого сигнала, несовершенство датчиков, неэффективность методов предобработки сигналов или методика вычисления параметров)?
Будем исходить из предположений, что прибор с достаточной точностью регистрирует сигнал и физиологическое состояние одного конкретного человека сильно не меняется. Точнее, второе предположение заключается в том, что при соблюдении всех предписаний к процедуре замеров (содержатся в инструкции к прибору) фотоплетизмограммы одного человека, снятые в разные моменты времени, отражают одно физиологическое состояние. Тогда пульсовая волна, которая предположительно содержит информацию о состоянии сердечно-сосудистой системы человека, не должна сильно меняться в фотоплетизмограммах одного человека.
Решим задачу идентификации пациента по его фотоплетизмограмме на основе сравнения с фотоплетизмограммами из базы (с обучающей выборкой). Высокое качество решения такой задачи косвенно подтвердит наши гипотезы. Даже если выборка будет собрана неверно (один пациент будет находиться в различных физиологических состояниях), идентификация будет возможна (главное, чтобы в обучающей выборке были фотоплетизмограммы, соответствующие состояниям пациента при формировании контрольной выборки). Невозможность качественной идентификации будет означать опровержение, по крайней мере, одной из наших гипотез. 
Отметим, что основное назначение приборов подобных «АнгиоСкан–01М» заключается в идентификации состояния сердечно-сосудистой системы. Но математически формализовать такую задачу и построить для её решения обучающую выборку очень сложно. По этой причине делается следующее естественное предположение: у разных людей состояния сердечно-сосудистых систем различаются, но состояние каждого претерпевает лишь незначительные изменения в пределах небольшого промежутка времени, в течение которого производится серия замеров кровяного давления. В рамках такого предположения задача идентификации состояний сердечно-сосудистой системы человека сводится к задаче идентификации человека.
Наибольший интерес при исследовании пульсовой волны представляет ее «профиль» – так мы будем называть её участок, соответствующий одному кардиоциклу. Методика вычисления характеристик сердечно-сосудистой системы, реализованная в «АнгиоСкан–01М», также предполагает выделение и анализ профилей. Поэтому будем производить идентификацию в два этапа:
• выделение профиля пульсовой волны из сигнала (или нескольких профилей),
• классификация человека по его профилю (по набору профилей). 
Эксперименты проведём на наборах данных, собранных с помощью прибора. В нём представлены фотоплетизмограммы 25 человек от 20 до 70 лет. Всего 150 сигналов, частота сигналов – 1000Гц, длительность от 50 до 80 секунд (это стандартная длительность, которая необходима прибору для оценки всех параметров в штатном режиме работы). Эксперименты на других наборах данных описаны в [13]. Пример фотоплетизмограммы из набора данных показан на рис. 2-4. Заметим, что часто на рисунках будут изображаться сигналы, снятые с помощью указанного выше прибора, т.е. значения сигналов противоположны давлению крови, поэтому фотоплетизмограммы изображаются с точностью до множителя (–1). 
Меры близости между сигналами
Для решения задачи классификации будем использовать метод ближайшего соседа или его обобщение – метод k ближайших соседей [14]. Причина выбора такого (достаточно тривиального) алгоритма состоит в желании сосредоточиться на выделении профиля и исследовании способов сравнения профилей, а не на генерации признаков и настройке алгоритмов машинного обучения.
Опишем некоторые меры близости (различия) для сигналов.
Косинусная мера сходства двух векторов x. широко применяется в анализе данных и может использоваться для оценки схожести профилей пульсовых волн, но для этого требуется, чтобы сравниваемые профили были одинаковой длины.
DTW-расстояние (т.е. расстояние, вычисленное с помощью динамической трансформации временно́й шкалы: Dynamic Time Warping) [15] применяется в анализе временных рядов и оценивает схожесть двух рядов с точностью до локальных горизонтальных сжатий и растяжений. Есть различные модификации этой метрики, мы рассмотрим следующую. Пусть необходимо вычислить расстояние между векторами x, y , здесь уже их длины могут быть различны. Определим функцию d. Тогда DTW ( x, y ) = d (n, m) , т.е. это значение вычисляется с помощью динамического программирования, параллельно получается путь трансформации состоящий из соседних точек на дискретной сетке, расстояние равно следующей сумме по всему пути трансформации. Путь трансформации задает метод трансформации одного сигнала в другой, сопоставляя пары точек, переходящих друг в друга. Можно определить разреженную бинарную матрицу размера n × m с единицами лишь в элементах, задаваемых парами индексов (i, j ) из пути трансформации. Пример такой матрицы проиллюстрирован на рис.5 (единичные элементы закрашены, нулевые – нет).
Мера сходства DTW имеет множество применений в распознавании речи, биоинформатике, распознавании рукописных текстов, обработке и анализе сигналов (см. [16]).
TWED-расстояние (Time Warp Edit Distance, [15]) похожа на DTW и разрабатывалась именно для анализа профиля пульсовой волны. Один из вариантов её задания следующий. Пусть x0 = y0 = 0 . Как и прежде определяем функцию d, тогда TWED ( x, y ) = d (n, m) . Для TWED по аналогии с DTW строится путь трансформации и соответствующая матрица. 
Предобработка сигналов и выделение пульсовых волн
Поскольку задача классификации будет проводиться по пульсовым волнам, необходимо их корректное выделение. Для этого с сигналом проводятся следующие операции:
0. Обрезка сигнала.
1. Сглаживание: s1 = h20 ( s ) .
2. Устранение тренда: s2 = s1 − h1000 ( s1 ) .
3. Выделение начальных и конечных точек профилей пульсовых волн. Здесь hk (s ) – применение свёртки с треугольным ядром ширины k к сигналу s = ( s1 ,…, sq ) . Обрезка сигнала иногда необходима, поскольку в первую и последнюю секунды измерения может быть много шума. Параметры (ширина окон) подобраны вручную: на собранном наборе данных при таком подборе все профили выделялись безошибочно. Отметим, что на сложных сигналах (фотоплетизмограммах, снятых во время операций) описанная последовательность преобразований сигналов не всегда приводит к корректным результатам, поскольку в этих сигналах больше резких перепадов. Использование фильтров, основанных на преобразовании Фурье, не повышало качество решения задачи.
Отметим, что сглаживание сигнала не ухудшает качество последующей классификации. Также другие способы вычитания тренда (например, локального линейного) не сильно влияют на итоговый результат. Устранение тренда необходимо для избавления от низкочастотного шума (вызванного движениями пациента во время замера), а также удаления волн дыхания и волн Майера. Классификация, использующая информацию из упомянутых волн, в данной работе не рассматривалась.
На этапе 3 ищутся точки локальных максимумов сигнала (соответствуют минимумам давления, поскольку сигнал отображает проницаемость пальца, и максимальная проницаемость соответствует минимальному давлению, см. рис. 2-4). Для этого хорошо подходит такая эвристика: находятся точки i , в которых значение si сигнала s = ( s1 ,…, sq ) не превышает значения в окрестности диаметра 2k + 1. Необходимость последнего действия вызвана тем, что часто даже после сглаживания в сигнале присутствовали «плато» – последовательности соседних точек с одинаковым значением сигнала. Весь сигнал нарезается по найденным точкам I. Считается, что мы выделили r профилей (участки между локальными максимумами). Неточности в выделении профилей (два настоящих профиля считаются одним – пропуск локального максимума, разбиение настоящего профиля на несколько частей – лишний локальный максимум) нивелируются следующими этапами алгоритма. Можно также отбрасывать подозрительно большие или маленькие (по длине) профили.
Как отмечалось выше, из каждого профиля a = (a1 ,…, ad ) можно ещё вычесть локальный линейный тренд. Для использования некоторых мер близости необходимо привести все профили к одной длине N. Если все выделенные профили сигнала привести к одной длине, то получится матрица B профилей размера N × r (по столбцам в ней записаны все профили). 
Естественно предположить, что у одного человека в разные моменты времени профили похожи (см. рис. 6). Возможно, человек не характеризуется каким-то одним профилем, а целым набором. Если выполнить неполное сингулярное разложение матрицы (SVD, [17]): (*), то в матрице U по столбцам будет записан базисный набор k профилей. 
Классификация сигналов
Простейший алгоритм классификации – метод ближайшего соседа, когда описания сигналов – главные профили, т.е. при описанной процедуре преобразования сигнала s его описание – первый столбец матрицы U . Поскольку все столбцы U для всех сигналов имеют единичную норму, то здесь косинусная мера сходства – скалярное произведение описаний. Столбцы матрицы U определяются с точностью до множителя ± 1 , поэтому для вычисления сходства следует использовать модуль скалярного произведения. В табл. 1 показано качество такого метода: доля верно классифицированных фотоплетизмограмм (т.е. доля верных идентификаций). Здесь и далее мы приводим качество классификации, полученное методом leave-one-out, т.е. из выборки последовательно исключается по одному сигналу и проводится его классификация, используя остальные сигналы. В табл.1 показано среднее качество классификации таких исключаемых сигналов. Строки соответствуют разным выборкам: с разными интервалами соседних замеров. Интуитивно понятно, что если интервалы небольшие, то качество идентификации человека по профилю должно быть высоким. Это подтверждают эксперименты. Если знаем профиль, который соответствует соседней минуте, то качество идентификации по текущему профилю превышает 85%. В дальнейшем будем приводить результаты экспериментов на выборке с двухдневными интервалами (это больше соответствует реальной ситуации).
Также отметим, что качество высокое только при использовании первой компоненты сингулярного разложения (классификация по первым столбцам матриц U ). При использовании меры близости сигналов, равной весовой сумме скалярных произведений разных компонент, максимизация качества по весам приводила к занулению всех весов, кроме первого. 
Классификация сигналов с помощью DTW и TWED
При использовании DTW и TWED возникает необходимость в настройке параметров. На рис. 7 показана зависимость качества классификации от этих параметров. Видно, что использование этих расстояний позволяет получать более высокое качество классификации.
На рис. 7 показано среднее значение функционала AUC ROC (площадь под ROC-кривой [18]), поясним, как оно вычислялось. Для каждого классифицируемого сигнала вычисляются оценки принадлежности к классам: расстояния до ближайшего сигнала из каждого класса, умноженные на (–1). Затем вычисляются значения AUC ROC для l задач бинарной классификации (с классами «соответствует i -му пациенту», «не соответствует», l – число человек, у которых снимались сигналы). Все l значений AUC ROC усредняются. Выбор такого функционала объясняется тем, что графики точности классификации, по причине небольшой выборки, кусочно-линейные и существенно меняются при изменении экспериментальной выборки. Графики AUC-ROC ведут себя стабильно и имеют чётко выраженные максимумы. Кроме того, AUC ROC подходит для несбалансированных выборок (в которых представителей одного класса существенно больше, чем других), в отличие от точности классификации.
Другой способ усреднения профилей
При классификации с помощью косинусной меры сходства можно использовать первую компоненту сингулярного разложения (*) или усреднение всех выделенных профилей пульсовой волны. Оба подхода дают примерно одинаковое качество классификации. Однако, учитывая, что использование DTW и TWED улучшает качество, можно предложить другой метод усреднения. Пусть профили для усреднения x i , i из I (до приведения к одной длине). Пусть также y их усреднение (после приведения к одной длине). При вычислении DTW(TWED) между векторами y и xi получаем матрицу трансформации T (i ) размера N × n(i ) . Тогда динамическим усреднением назовём sigma. Таким образом, мы усредняем профили с учётом схожести их точек. Каждый элемент в полученном N -мерном векторе является средним значений похожих точек разных профилей.
Как показали эксперименты, такое усреднение позволяет повысить качество классификации на основе косинусной меры сходства, но не сильно повышает качество классификации на основе DTW и TWED. 
Классификация с помощью голосования
Вместо классификации по одному (среднему) профилю пульсовой волны или по набору (базисных) профилей, можно использовать все выделенные профили. Для каждого профиля в классифицируемом сигнале мы находим максимально похожий из базы (обучающей выборки) и устраиваем голосование по большинству. Подобная процедура вычислительно очень трудоёмкая, но для нашей экспериментальной (относительно небольшой) выборки была проведена, чтобы оценить эффективность этого метода. В табл. 2 показано качество классификации при таком голосовании.
Заключение
Задача классификации пациента по фотоплетизмограмме решается с достаточно высокой точностью: для выборки из 150 сигналов 25 человек, описанной в работе, точность достигает 70%. При использовании для классификации одного (усреднённого) профиля и простой косинусной меры сходства качество достигало 60%, что также является высоким показателем (качество случайного угадывания в этой задаче – 4%). Напомним, что выборка формировалась таким образом, что для каждого человека фотоплетизмограмма снималась не чаще, чем один раз в два дня.
Существенное улучшение качества – на 26% – наблюдается при сокращении интервала между соседними замерами фотоплетизмограмм при формировании выборки. Это позволяет сделать вывод, что профили в соседние моменты времени существенно более схожи, чем профили, разнесённые во времени.
В работе рассмотрены метрики DTW и TWED, которые повышают качество идентификации по пульсовой волне и позволяют строить новые алгоритмы (например, применять новые методы усреднения профилей).
Отметим, что подобную проблему по заказу компании «АнгиосканЭлектроникс» решала компания «АлгоМост». Подробные результаты этого проекта являются коммерческой тайной, однако качественно выводы сделаны такие же. В отличие от задачи, рассмотренной в данной работе, «АлгоМост» исследовал вопросы устойчивости вычисляемых характеристик, а не профилей пульсовых волн. Новизна иследований в настоящей статье в изучении динамических метрик и использовании расширенной выборки для экспериментов.

В этой работе рассматривается роль информационных технологий в медицине, особенно в анализе сигналов кровяного давления с использованием фотоплетизмографии. Фотоплетизмограммы (PPG) получаются с помощью измерения поглощения света инфракрасного излучения органами, что отражает плотность кровяного потока. Авторы изучают пульсовые волны в PPG, которые содержат информацию о состоянии сердечно-сосудистой системы. В работе рассматривается задача идентификации пациента по его PPG с целью подтверждения гипотезы о том, что фотоплетизмограммы отражают физиологическое состояние одного. Описывается эксперимент на данных от 25 человек, включающий фотоплетизмограммы различных возрастов сигналов. В качестве мер близости между сигналами авторы рассматривают косинусную меру сходства, DTW-расстояние и TWED-расстояние. Для выделения профилей пульсовых волн сначала проводится предобработка сигналов, включающая обрезку, сглаживание и устранение тренда. Затем профили выделяются путем поиска локальных максимумов. Исследуются различные методы классификации сигналов: ближайшего соседа, DTW и TWED, голосованием. Задача классификации пациентов по фотоплетизмограмме решается с высокой точностью, особенно при использовании методов DTW и TWED. Улучшение качества классификации достигается сокращением интервала между соседними замерами фотоплетизмограмм.