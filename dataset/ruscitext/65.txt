РЕГУЛЯРИЗИРУЮЩИЙ МЕТОД ВОССТАНОВЛЕНИЯ ФАЗЫ ПРИ УЛЬТРАЗВУКОВОМ МЕДИЦИНСКОМ ЦВЕТОВОМ ДОППЛЕРОВСКОМ КАРТИРОВАНИИ 

Введение
Цветовое допплеровское картирование (ЦДК) сердца основано на кодировании в цвете значения допплеровского сдвига излучаемой частоты. Методика обеспечивает прямую визуализацию потоков крови в сердце и в относительно крупных сосудах. При визуализации красный цвет (белый цвет - на изображениях в градациях серого) соответствует потоку, идущему в сторону датчика, синий (черный) – от датчика. Темные оттенки этих цветов соответствуют низким скоростям, светлые оттенки – высоким. Одним из основных недостатков метода является невозможность получения изображения мелких кровеносных сосудов с маленькой скоростью кровотока. К достоинствам метода можно отнести возможность оценивать как морфологическое состояние сосудов, так и состояние кровотока по ним. В то же время, необходимо отметить, что результаты измерений являются достаточно сильно зашумленными, и в некоторых областях (обычно в зонах с повышенной турбулентностью) датчик не способен определить скорость кровотока. Также, из-за ограниченности скорости звука не всегда возможно подобрать оптимальные параметры сканирования.
Датчик определяет скорость определенного сканируемого участка следующим образом: он посылает несколько импульсов и измеряет изменение фазы возвращенных сигналов (эффект Допплера). Если интервал между импульсами мал, а измеряемая скорость велика, то изменение фазы может превысить 2pi . Однако датчик способен измерять изменение фазы лишь в интервале [−pi , pi ] . Поэтому происходит так называемое "заворачивание"(wrapping) фазы (в эхокардиографии его принято называть "алиасинг"). 
Решение возникающей проблемы является наиболее актуальной задачей обработки видеоданных, полученных методом ЦДК. Требуется восстановить реальные фазы сигналов, обусловленные ошибками, возникающими при попытке снимать с высокой частотой кадров.
Таким образом, в результате измерений мы имеем: (1).
Задача восстановления фазы (развертывание фазы) в общем случае является некорректной. Однако нам известно, что наблюдаемое поле является потоком крови, а поток крови должен быть непрерывным и гладким. Используя эту дополнительную информацию, можно построить регуляризирующий алгоритм, при котором минимизирующий функционал учитывает условия гладкости решения.
Существует много разных подходов решения задачи развертывания фазы: с использованием алгоритма разреза графов [1], [2], минимизация L2 нормы [3] и L p нормы [4] частных производных поля, использование регуляризирующих условий [5]. Отметим и проиллюстрируем на Рис. 1 характерные свойства данных алгоритмов (Рис. 1а – шкала фаз, Рис. 1б – исходное ЦДК изображение левого желудочка сердца).
Методы, использующие разрезы графов для восстановления фазы, имеют преимущество в том, что найденный сигнал отличается от начального на целое число полных периодов 2pi в каждой точке. Кроме того, у этого метода существуют очень быстрые методы решения. Однако эти методы плохо справляются с наличием областей, где датчик затрудняется определить скорость и направление потока или определяет ее неправильно (Рис. 1в). Также, эти методы плохо пригодны для подавления шумов.
Методы, использующие минимизацию L2 нормы и L p нормы частных производных сигнала, позволяют подавить шумы и не столь чувствительны к пропуску данных. Однако результат может отличаться от оригинала не на целое число периодов 2pi (Рис. 1г).
Методы, использующие регуляризацию, также основаны на минимизации частных производных сигнала, однако позволяют лучше адаптироваться к различным задачам ЦДК, чем [3] и [4]. Представленный в данной статье метод близок к методу [5], однако позволяет решать задачу при наличии большого количества зон, где не известны скорости потока. Это достигается за счет включения в стабилизатор члена, использующего первую производную решения. Также данный метод рассчитан на работу с сигналом – потоком жидкости. При расчете невязки решения учитывается направление движения относительно датчика.
Регуляризирующий метод восстановления фазы сигнала
Рассмотрим прямоугольную сетку O размера M ×N: O = {( x, y ) x = 0,..., M − 1, y = 0,..., N − 1} . Определим на этой сетке несколько подмножеств: подмножество S , на котором известны измерения датчика, и подмножество D , на котором искомая фаза φ должна быть гладкой. При расчетах в данной статье D ≡ O .
При сканировании, для определения скорости в определенной точке, датчик испускает несколько УЗ импульсов и усредняет полученные скорости для большей надежности результата. Если промежуточные результаты значительно отличаются для разных импульсов, то считается, что определить скорость в этой точке невозможно. При визуализации, части этой области D \ S отмечаются отдельным цветом.
Пусть g – наблюдаемый сигнал в задаче (1). Мы будем искать гладкое решение φ ( x, y ) , связанное с исходным сигналом g соотношением (2).
Определим функции g x , g y.
Мы ищем решение задачи (2) как минимум функционала вида (3).
Здесь разность между производными решения φ ( x, y ) и известными нам значениями g x и g y/
Слагаемое P1φ отражает требование гладкости поля φ .
В областях, в которых датчик затрудняется определить фазу (область D \ S ), поле также должно быть непрерывным, поэтому в этих областях не должно быть резких скачков производных. Данное условие отражено наличием в минимизируемом функционале слагаемого P2u .
Алгоритм минимизации
Для решения задачи минимизации функционала ищется решение уравнения (4).
Уравнение (4) решается методом сопряженных градиентов.
Настройка параметров метода
Предложенный метод содержит ряд параметров, отражающих как физику процесса получения сигнала, так и требования, накладываемые на получаемое решение. Рассмотрим ниже их влияние на получаемый результат – ЦДК изображение.
Параметры a x , a y отвечают за то, с какими весами будут учитываться известные производные g по x и по y . Поскольку наблюдаемый сигнал является скоростью потока жидкости по направлению к датчику, то производные по направлению к датчику должны быть более гладкими, чем в перпендикулярном направлении. Обычно на изображении датчик расположен сверху, т.е. направление к датчику соответствует оси y , в то время как перпендикулярное ему направление соответствует оси x . Следовательно, коэффициент a y должен быть существенно больше a x .
Примеры результатов, полученных при различных соотношениях параметров a x и a y , показаны на рисунке 2. На данном кадре показан момент систолы, т.е. мощного вброса крови в левый желудочек. Скорость потока при этом зашкаливает, и возникает алиасинг (темные области на изображении 2в). Если коэффициент a x достаточно большой, то алгоритм будет пытаться сгладить края этого потока, занижая при этом реальные скорости (рисунок 2г). Нами были выбраны a x = 0.1, a y = 1 как наиболее оптимальные параметры. параметрах a x и a y : а) – шкала, б) – исходный сигнал, в) – результат восстановления фазы при a x = 1, a y = 1, г) – результат восстановления фазы при a x = 0.1, a y = 1 .
Гладкость получаемого поля зависит от использованного значения параметра lamb . Чем больше параметр lamb , тем более гладким получается результат. Это позволяет избавиться от шумов, однако при больших значениях lamb происходит потеря мелких деталей изображения. В то же время, если параметр lamb слишком мал, то алиасинг в некоторых местах может не подавиться. В нашей реализации используется значение lamb = 0.1.
Производные φx и φ y должны быть непрерывны на всей области D . В области S , где известны значения производных g x и g y , это достигается видом невязки в функционале (3) и введенными ограничениями на значения g x и g y . В области D \ S ограничение производных φx и φ y происходит за счет слагаемого P2 . Поэтому коэффициент регуляризации γ отвечает за то, насколько гладким должен быть поток в обастях, где датчик не может определить значение. Чем больше параметр γ , тем более гладкой будет найденный поток в зонах D \ S . Результаты восстановления фазы, полученные при различных значениях параметра γ , показаны на рисунке 3. На данном рисунке приведен момент систолы. Если параметр γ слишком мал, то из-за большого количества зон с неизвестными скоростями, алгоритм не может связать области алиасинга с окружающими их областями (рис. 3в).
Выбор параметров метода и анализ результатов его работы были проведены на медицинских снимках пациентов со здоровым сердцем и снимках пациентов с различными заболеваниями. Исследования проводились в Российском научном центре хирургии им. Б.В.Петровского [6]. Практика использования метода при клинических исследованиях показала, что результаты его применения повышают информативность ЦДК снимков при диагностике пациентов.

В статье рассматривается цветовое допплеровское картирование (ЦДК) сердца, в частности особенности, достоинства и недостатки метода. 
Исследуются разные подходы решения, одной из возникающих проблем метода, а именно задачи развертывания фазы.
Предложен регуляризирующий метод восстановления фазы сигнала, который содержит ряд параметров, отражающих как физику процесса получения сигнала, так и требования, накладываемые на получаемое решение.
В заключении сказано, что результаты применения метода на практике повышают информативность ЦДК снимков при диагностике пациентов.