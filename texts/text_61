Средство автоматического тестирования корректности работы аппарата виртуальной памяти

Зачастую возникает необходимость запуска программы на платформе, отличающейся от той, под которую она была разработана. Эмуляторы решают эту задачу, однако во время их разработки необходимо проверять, что эмуляция каждого аппаратного средства работает также, как и само это средство.
В выпускной квалификационной работе рассматривается задача разработки инструмента автоматического тестирования аппарата виртуальной памяти. Искомый инструмент предназначается для тестирования реализации аппарата, специфичной для архитектуры x86_64. Также он должен запускаться внутри эмулятора и предоставлять тестам программный интерфейс, обеспечивающий их необходимой функциональностью.
В результате анализа задачи были сформулированы требования к искомому средству: наличие программного интерфейса, запуск вне операционной системы для обеспечения тестов достаточной свободой работы с аппаратным средством, вывод сообщений для отслеживания успешного и неуспешного прохождения тестов.
Рассмотрены существующие инструменты тестирования (например, ) и причины, не позволяющие использовать их в данном контексте. Большинство рассмотренных инструментов работают внутри ОС, остальные же не предоставляют достаточно полного API. По итогам рассмотрения было решено разработать средство с нуля, используя идеи существующих.
В программный интерфейс вошли базовые функции работы с виртуальной памятью вместе с функцией await_PF, обеспечивающей возможность проверки отсутствия доступа по адресу. Роль последней заключается в том, что при тестировании аппарата виртуальной памяти необходимо в том числе проверять, что страничное нарушение возникает, когда должно возникать, и не возникает в иных случаях. В связи с этим разработка функции await_PF происходит вместе с разработкой специального обработчика страничного нарушения, от которого требуется поддержка продолжения работы теста в случае преднамеренного возникновения данного нарушения. Их совместная работа заключается в следующем:
—	функция принимает адрес и тип доступа, после чего сохраняет в специальной глобальной переменной адрес возврата после возникновения ошибки страницы и пытается произвести доступ;
—	если срабатывает защита доступа и возникает страничное нарушение, его обработчик смотрит в глобальную переменную, убеждается, что нарушение было специально спровоцировано тестом, и возвращается на хранящийся в переменной адрес;
—	функция проверяет, что страничное нарушение произошло, и выводит сообщение об ошибке в противном случае.
Под базовыми функциями работы с виртуальной памятью подразумеваются создание нового отображения виртуального адреса на физический, а также удаление и изменение существующего.
Инструмент соответствует стандарту Multiboot , что позволяет запускать его вне ОС с помощью любого загрузчика, также соответствующего данному стандарту.
Проверка работоспособности инструмента была произведена на наборе специально подготовленных тестов. Их задачей было убедиться, что инструмент полностью соответствует сформированным требованиям. Запуск данных тестов подтвердил это.
