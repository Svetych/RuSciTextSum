Кроссплатформенное приложение для распознавания шахматных партий в режиме реального времени

Шахматы являются самой распространенной настольной игрой в мире. Однако для отслеживания партий на турнирах или дистанционной игры людям приходится записывать ходы вручную или использовать дорогостоящие электронные доски. Приложение, способное в режиме реального времени распознавать шахматные позиции по видео, позволит значительно уменьшить нагрузку на каналы связи при трансляции шахматных турниров, а также производить попутный анализ партий программами-анализаторами.
Первостепенной задачей для распознавания шахматных позиций является поиск шахматной доски на изображении. Для проверки эффективности алгоритмов поиска доски был создан набор данных из четырех тысяч фотографий разных шахматных досок. Фотографии были произведены разными камерами, с разным освещением и расположением фигур. При проверке на этом наборе данных лучший существующий алгоритм  показал точность не более 80%. После существенных доработок точность алгоритма была повышена до 99.7%, а время обработки одного кадра снизилось с 5 секунд до 50 миллисекунд. Удалось полностью избежать использования нейронных сетей для определения ключевых точек, что и стало залогом более быстрой и точной работы алгоритма.
Для решения задачи классификации шахматных фигур было дообучено более шестидесяти нейронных сетей . Ввиду отсутствия качественных наборов данных был создан собственный набор, состоящий более чем из миллиона разнородных фотографий шахматных фигур. Также была произведена тонкая настройка дообученной нейронной сети MobileNetV3 . Так как реализация данной архитектуры отсутствовала в библиотеке Keras, архитектура была реализована самостоятельно, а после одобрения авторами библиотеки добавлена в общедоступный набор базовых архитектур. Доработанная с учетом задачи классификации шахматных фигур нейронная сеть показывает точность 99.81% при времени обработки одной клетки 3 мс.
Шахматная партия представляет собой итеративные изменения положений и количества шахматных фигур на доске. Для того, чтобы не обрабатывать каждый кадр из потока, а также не обрабатывать клетки, на которых не происходило изменений, был реализован инвариантный к освещению и устойчивый к шумам детектор различий, основанный на алгоритмах детекторов движений и поиска теней .
Периодически шахматную доску с фигурами заслоняет рука игрока. И если игрок, задержав свою руку неподвижно над доской, введет в заблуждение детектор движения, то фотография с рукой пойдет на вход классификатору шахматных фигур. Во избежание этого был обучен SSDLite детектор рук игроков, основанный на нейронной сети MobileNetV2 . Для обучения детектора было собрано более десяти тысяч фотографий человеческих рук.
В результате данной работы на языке С++ при помощи библиотек OpenCV и TensorFlow разработано кроссплатформенное приложение, время обработки одного хода в котором не превышает 250 мс на одном ядре смартфона Pixel1, что позволяет распознавать шахматные партии в режиме реального времени.
